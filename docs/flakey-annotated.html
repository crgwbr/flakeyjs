<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>flakey-annotated.coffee</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  
  <div class='section'>
    <div class='docs'><h1>flakey-annotated.coffee</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <h1>Flakey.js</h1>
<p>See AUTHORS file for credits</p>
<p>Flakey.js is compiled by concat'ing the src 
files in this directory in the following order:</p>
<ol>
<li>flakey.coffee</li>
<li>util.coffee</li>
<li>models.coffee</li>
<li>controllers.coffee</li>
<li>views.coffee</li>
<li>exports.coffee</li>
</ol>
<p>This assembled file is then saved in <code>../flakey.coffee</code>
and compiled into <code>../flakey.js</code> and <code>../flakey.min.js</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <h2>Basic Setup</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nv">Flakey = </span><span class="p">{</span>
  <span class="nv">diff_patch: </span><span class="k">new</span> <span class="nx">diff_match_patch</span><span class="p">()</span>
  <span class="nv">settings: </span><span class="p">{</span>
    <span class="nv">diff_text: </span><span class="kc">true</span>
    <span class="nv">container: </span><span class="kc">undefined</span>
    <span class="nv">read_backend: </span><span class="s1">&#39;memory&#39;</span>
    <span class="nv">base_model_endpoint: </span><span class="kc">null</span> <span class="c1">#&#39;/api&#39;</span>
    <span class="nv">socketio_server: </span><span class="kc">null</span>
    <span class="nv">enabled_local_backend: </span><span class="kc">true</span>
  <span class="p">}</span>
  <span class="nv">status: </span><span class="p">{</span>
    <span class="nv">server_online: </span><span class="kc">undefined</span> 
  <span class="p">}</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Put JQuery into No-Conflict mode, so that we don't interfere with any other library's</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">noConflict</span><span class="p">()</span>
<span class="nv">$ = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nv">$ = </span><span class="nx">jQuery</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Make JSON accessible too</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nv">JSON = Flakey.JSON = </span><span class="nx">JSON</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Flakey's "contructor." This should be called on page load to customize settings and
init the model backend controller.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nv">Flakey.init = </span><span class="nf">(config) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Setup config</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">config</span>
    <span class="nx">Flakey</span><span class="p">.</span><span class="nx">settings</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Init this now so the new settings take effect</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">Flakey.models.backend_controller = </span><span class="k">new</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">BackendController</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <h2>Common Utility Functions</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nv">Flakey.util = </span><span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Run a function asynchronously</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">async: </span><span class="nf">(fn) -&gt;</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Deep Compare 2 objects, recursing down through arrays and objects so 
that we can compare only primitive types. Return true if they are equal</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">deep_compare: </span><span class="nf">(a, b) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">a</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">b</span>
      <span class="k">return</span> <span class="kc">false</span>
    
    <span class="nv">compare_objects = </span><span class="nf">(a, b) -&gt;</span>
      <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">a</span>
        <span class="k">if</span> <span class="o">not</span> <span class="nx">b</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">?</span>
          <span class="k">return</span> <span class="kc">false</span>
      
      <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">b</span>
        <span class="k">if</span> <span class="o">not</span> <span class="nx">a</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">?</span>
          <span class="k">return</span> <span class="kc">false</span>
      
      <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">a</span>
        <span class="k">if</span> <span class="nx">value</span>
          <span class="k">switch</span> <span class="k">typeof</span> <span class="nx">value</span>
            <span class="k">when</span> <span class="s1">&#39;object&#39;</span>
              <span class="k">if</span> <span class="o">not</span> <span class="nx">compare_objects</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">b</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="k">else</span>
              <span class="k">if</span> <span class="nx">value</span> <span class="o">!=</span> <span class="nx">b</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
                <span class="k">return</span> <span class="kc">false</span>
        <span class="k">else</span>
          <span class="k">if</span> <span class="nx">b</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">false</span>
      
      <span class="k">return</span> <span class="kc">true</span>
    
    <span class="k">switch</span> <span class="k">typeof</span> <span class="nx">a</span>
      <span class="k">when</span> <span class="s1">&#39;object&#39;</span>
        <span class="k">if</span> <span class="o">not</span> <span class="nx">compare_objects</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
          <span class="k">return</span> <span class="kc">false</span>
      <span class="k">else</span>
        <span class="k">if</span> <span class="nx">a</span> <span class="o">!=</span> <span class="nx">b</span>
          <span class="k">return</span> <span class="kc">false</span>
    
    <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>GUID function from <a href="https://github.com/maccman/spine/blob/master/src/spine.coffee">spine.js</a></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">guid: </span><span class="nf">() -&gt;</span>
    <span class="nv">guid = </span><span class="s1">&#39;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&#39;</span>
    <span class="nv">guid = </span><span class="nx">guid</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[xy]/g</span><span class="p">,</span> <span class="nf">(c) -&gt;</span>
      <span class="nv">r = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">|</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span>
        <span class="nv">v = </span><span class="nx">r</span> 
      <span class="k">else</span> 
        <span class="nv">v = </span><span class="nx">r</span> <span class="o">&amp;</span> <span class="mi">3</span> <span class="o">|</span> <span class="mi">8</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">v</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nx">guid</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Return current URL hash</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">get_hash: </span><span class="nf">() -&gt;</span>
    <span class="nv">hash = </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span>
    <span class="k">if</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nv">hash = </span><span class="nx">hash</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">hash</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <h3>Querystring functions</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">querystring : </span><span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Parse a querystring and return an obj of key/values</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">parse: </span><span class="nf">(str) -&gt;</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">str</span> <span class="o">or</span> <span class="nx">str</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!=</span> <span class="nb">String</span>
        <span class="k">return</span> <span class="p">{}</span>
      <span class="nv">pairs = </span><span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
      <span class="nv">params = </span><span class="p">{}</span>
      <span class="k">for</span> <span class="nx">pair</span> <span class="k">in</span> <span class="nx">pairs</span>
        <span class="nv">pair = </span><span class="nx">pair</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
        <span class="nv">key = </span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nv">value = </span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="nx">params</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
      <span class="k">return</span> <span class="nx">params</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Build a querystring out of an obj</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">build: </span><span class="nf">(params) -&gt;</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">params</span> <span class="o">or</span> <span class="nx">params</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!=</span> <span class="nb">Object</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
      <span class="nv">pairs = </span><span class="p">[]</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">params</span>
        <span class="nx">pairs</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;#{encodeURIComponent(key)}=#{encodeURIComponent(value)}&quot;</span>
      <span class="k">return</span> <span class="nx">pairs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Update the page's current querystring.
Setting merge to true will add your params to the current querystring. 
By default, your params wipe out the current querystring.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">update: </span><span class="nf">(params, merge = false) -&gt;</span>
      <span class="nv">hash = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">get_hash</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
        <span class="nv">hash = </span><span class="nx">hash</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
        <span class="nv">location = </span><span class="nx">hash</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nv">query = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">querystring</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">hash</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="k">else</span>
        <span class="nv">location = </span><span class="nx">hash</span>
        <span class="nv">query = </span><span class="p">{}</span>
      <span class="k">if</span> <span class="nx">merge</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nv">query = </span><span class="nx">params</span>
      <span class="nb">window</span><span class="p">.</span><span class="nv">location.hash = </span><span class="s2">&quot;#{location}?#{Flakey.util.querystring.build(query)}&quot;</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <h3>Basic Observer Event System</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">Events</span>
  <span class="nv">events: </span><span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Register a new function to be triggered by the given event. You may optionally provide a namespace
to protect you app's events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">register: </span><span class="nf">(event, fn, namespace = &#39;flakey&#39;) -&gt;</span>
    <span class="k">if</span> <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span>
      <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">event</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Trigger an event by passing it's name and optionally the namespace and data to send to each listening function</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">trigger: </span><span class="nf">(event, namespace = &#39;flakey&#39;, data = {}) -&gt;</span>
    <span class="k">if</span> <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">==</span> <span class="kc">undefined</span>
      <span class="k">return</span>
    <span class="nv">output = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">fn</span> <span class="k">in</span> <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span>
      <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="nx">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Wipeout all registered functions from a namesapce. Dangerous.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">clear: </span><span class="nf">(namespace = &#39;flakey&#39;) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@events</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="nv">Flakey.events = </span><span class="k">new</span> <span class="nx">Events</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <h2>Model and model backend code</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <h3>Subclass this to create you own models</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">Model</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="vi">@model_name: </span><span class="kc">null</span>
  <span class="vi">@fields: </span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>If your model has a constructor, it should call this via super()</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(init_values) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@id = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">guid</span><span class="p">()</span>
    <span class="vi">@versions = </span><span class="p">[]</span>
    
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">init_values</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <h4>Class Methods</h4>
<p>List all objects</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="vi">@all: </span><span class="nf">() -&gt;</span>
    <span class="nv">set = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">obj</span> <span class="k">in</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">@model_name</span><span class="p">)</span>
      <span class="nv">m = </span><span class="k">new</span> <span class="err">@</span><span class="p">()</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">import</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
      <span class="nx">set</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">set</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>Query for a set of objects by a query object. e.g. Model.find({name: 'sam'})</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="vi">@find: </span><span class="nf">(query) -&gt;</span>
    <span class="nv">ar = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">@model_name</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">ar</span><span class="p">.</span><span class="nx">length</span>
      <span class="k">return</span> <span class="p">[]</span>

    <span class="nv">set = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">ar</span>
      <span class="nv">m = </span><span class="k">new</span> <span class="err">@</span><span class="p">()</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">import</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
      <span class="nx">set</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">set</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Query for a single object by it's id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="vi">@get: </span><span class="nf">(id) -&gt;</span>
    <span class="nv">obj = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">@model_name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">obj</span>
      <span class="k">return</span> <span class="kc">undefined</span>
    <span class="nv">m = </span><span class="k">new</span> <span class="err">@</span><span class="p">()</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">import</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">m</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>Full Text Search fields based on the given string / regular expression</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="vi">@search: </span><span class="nf">(re, fields = @fields) -&gt;</span>
    <span class="nv">query = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">fields</span>
      <span class="nx">query</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">re</span>
    <span class="nv">ar = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">@model_name</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">ar</span><span class="p">.</span><span class="nx">length</span>
      <span class="k">return</span> <span class="p">[]</span>

    <span class="nv">set = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">ar</span>
      <span class="nv">m = </span><span class="k">new</span> <span class="err">@</span><span class="p">()</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">import</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
      <span class="nx">set</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">set</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <h4>Public Methods</h4>
<p>Delete this instance from all backends. Just like a real database, this is irreversible.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">delete</span><span class="o">:</span> <span class="nf">() -&gt;</span>
    <span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">model_name</span><span class="p">,</span> <span class="nx">@id</span><span class="p">)</span>
    <span class="nv">event_key = </span><span class="s2">&quot;model_#{ @constructor.model_name.toLowerCase() }_updated&quot;</span>
    <span class="nx">Flakey</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">event_key</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Rollback this instance. If version_id is numeric, rollback that many versions. If it's a version_id, rollback to that version.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">rollback: </span><span class="nf">(version_id) -&gt;</span>
    <span class="k">if</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">version_id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">@versions</span><span class="p">.</span><span class="nx">length</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nb">Array</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">version_id</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">@pop_version</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nv">exists = </span><span class="kc">false</span>
      <span class="k">for</span> <span class="nx">version</span> <span class="k">in</span> <span class="nx">@versions</span>
        <span class="k">if</span> <span class="nx">version</span><span class="p">.</span><span class="nx">version_id</span> <span class="o">==</span> <span class="nx">version_id</span>
          <span class="nv">exists = </span><span class="kc">true</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">exists</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">ReferenceError</span><span class="p">(</span><span class="s2">&quot;Version #{ version_id } does not exist.&quot;</span><span class="p">)</span>

      <span class="nv">latest = </span><span class="nx">@versions</span><span class="p">[</span><span class="nx">@versions</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
      <span class="k">while</span> <span class="nx">latest</span><span class="p">.</span><span class="nx">version_id</span> <span class="o">!=</span> <span class="nx">version_id</span> <span class="o">and</span> <span class="nx">@versions</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="nx">@pop_version</span><span class="p">()</span>
        <span class="nv">latest = </span><span class="nx">@versions</span><span class="p">[</span><span class="nx">@versions</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nx">@import</span> <span class="p">{</span>
      <span class="nv">id: </span><span class="nx">@id</span>
      <span class="nv">versions: </span><span class="nx">@versions</span>
    <span class="p">}</span>
    <span class="nx">@write</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>Save this instance and write it to persistant storage.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">save: </span><span class="nf">(callback) -&gt;</span>
    <span class="nv">new_obj = </span><span class="nx">@export</span><span class="p">()</span>
    <span class="nv">old_obj = </span><span class="nx">@evolve</span><span class="p">()</span>
    <span class="nv">diff = </span><span class="nx">@diff</span><span class="p">(</span><span class="nx">new_obj</span><span class="p">,</span> <span class="nx">old_obj</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">diff</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">@push_version</span><span class="p">(</span><span class="nx">diff</span><span class="p">)</span>
      <span class="nx">@write</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">callback</span><span class="o">?</span>
      <span class="nx">callback</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <h4>Private Methods</h4>
<p>Compares two objects (old and new) and returns a delta object representing the changes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">diff: </span><span class="nf">(new_obj, old_obj) -&gt;</span>
    <span class="nv">save = </span><span class="p">{}</span>
    
    <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">fields</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">deep_compare</span><span class="p">(</span><span class="nx">new_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">old_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
        <span class="k">switch</span> <span class="nx">new_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">constructor</span>
          <span class="k">when</span> <span class="nb">Object</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>Use $.extend as a bit of a hack to get a deep copy of the object instead of a reference.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="nx">save</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">new_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
          <span class="k">when</span> <span class="nb">Array</span>
            <span class="nx">save</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">[],</span> <span class="nx">new_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
          <span class="k">when</span> <span class="nb">String</span>
            <span class="nx">old_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">old_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">?</span> <span class="k">then</span> <span class="nx">old_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">toString</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">diff_text</span>
              <span class="nv">patches = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">diff_patch</span><span class="p">.</span><span class="nx">patch_make</span><span class="p">(</span><span class="nx">old_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">new_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
              <span class="nx">save</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nv">constructor: </span><span class="s1">&#39;Patch&#39;</span>
                <span class="nv">patch_text: </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">diff_patch</span><span class="p">.</span><span class="nx">patch_toText</span><span class="p">(</span><span class="nx">patches</span><span class="p">)</span>
              <span class="p">}</span>
            <span class="k">else</span>
              <span class="nx">save</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">new_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
          <span class="k">else</span>
            <span class="nx">save</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">new_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">save</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>Freeze the instance's current fields into an object and return it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">export: </span><span class="nf">() -&gt;</span>
    <span class="nv">obj = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">field</span> <span class="k">in</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">fields</span>
      <span class="nx">obj</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">obj</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>Given a version history and a version_id to stop at, evolve a blank object
to the to the state at version_id. If version_id is ommited, evolve over the
entire version history. If versions is ommited, get the version history of the
current object.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">evolve: </span><span class="nf">(version_id, versions) -&gt;</span>
    <span class="nv">obj = </span><span class="p">{}</span>
    
    <span class="k">if</span> <span class="nx">versions</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">or</span> <span class="nx">versions</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!=</span> <span class="nb">Array</span>
      <span class="nv">saved = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">model_name</span><span class="p">,</span> <span class="nx">@id</span><span class="p">)</span>
      <span class="nv">versions = </span><span class="k">if</span> <span class="nx">saved</span><span class="o">?</span> <span class="k">then</span> <span class="nx">saved</span><span class="p">.</span><span class="nx">versions</span> <span class="k">else</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="nx">rev</span> <span class="k">in</span> <span class="nx">versions</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">rev</span><span class="p">.</span><span class="nx">fields</span>
        <span class="k">switch</span> <span class="nx">value</span><span class="p">.</span><span class="nx">constructor</span>
          <span class="k">when</span> <span class="s1">&#39;Patch&#39;</span>
            <span class="nv">patches = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">diff_patch</span><span class="p">.</span><span class="nx">patch_fromText</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">patch_text</span><span class="p">)</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">diff_patch</span><span class="p">.</span><span class="nx">patch_apply</span><span class="p">(</span><span class="nx">patches</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
          <span class="k">when</span> <span class="nb">Object</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">value</span><span class="p">)</span>
          <span class="k">when</span> <span class="nb">Array</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">[],</span> <span class="nx">value</span><span class="p">)</span>
          <span class="k">else</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
      <span class="k">if</span> <span class="nx">version_id</span> <span class="o">!=</span> <span class="kc">undefined</span> <span class="o">and</span> <span class="nx">version_id</span> <span class="o">==</span> <span class="nx">rev</span><span class="p">.</span><span class="nx">version_id</span>
        <span class="k">return</span> <span class="nx">obj</span>
    <span class="k">return</span> <span class="nx">obj</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>Take a stored object from the backend controller, and loads it's data into this instance</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">import: </span><span class="nf">(obj) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@versions = </span><span class="nx">obj</span><span class="p">.</span><span class="nx">versions</span>
    <span class="vi">@id = </span><span class="nx">obj</span><span class="p">.</span><span class="nx">id</span>
    
    <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">fields</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span>
    
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">@evolve</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">@versions</span><span class="p">)</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>Pop a version off the history array</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">pop_version: </span><span class="nf">() -&gt;</span>
    <span class="k">if</span> <span class="nx">@versions</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">@versions</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>Push a diff onto the history array</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">push_version: </span><span class="nf">(diff) -&gt;</span>
    <span class="nv">version_id = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">guid</span><span class="p">()</span>
    <span class="nv">version = </span><span class="p">{</span>
      <span class="nv">version_id: </span><span class="nx">version_id</span><span class="p">,</span>
      <span class="nv">time: </span><span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()),</span>
      <span class="nv">fields: </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">diff</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@versions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>Write the version history into persistent storage.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">write: </span><span class="nf">(callback) -&gt;</span>
    <span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span>
      <span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">model_name</span><span class="p">,</span> <span class="nx">@id</span><span class="p">,</span> <span class="nx">@versions</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">callback</span><span class="o">?</span> <span class="k">then</span> <span class="nx">callback</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>Trigger the saved event</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nv">event_key = </span><span class="s2">&quot;model_#{ @constructor.model_name.toLowerCase() }_updated&quot;</span>
      <span class="nx">Flakey</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">event_key</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>The backend controler takes care of managing multiple storage backends and querying them for data.
You should <strong>never</strong> need to call any of these methods from outside this file.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">BackendController</span>
  <span class="nv">constructor: </span><span class="nf">() -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@delim = </span><span class="s1">&#39;:::&#39;</span>
    <span class="vi">@backends = </span><span class="p">{</span>
      <span class="nv">memory: </span><span class="p">{</span>
        <span class="nv">log_key: </span><span class="s1">&#39;flakey-memory-log&#39;</span>
        <span class="nv">pending_log: </span><span class="p">[]</span>
        <span class="nv">interface: </span><span class="k">new</span> <span class="nx">MemoryBackend</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">enabled_local_backend</span>
      <span class="nx">@backends</span><span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nv">log_key: </span><span class="s1">&#39;flakey-local-log&#39;</span>
        <span class="nv">pending_log: </span><span class="p">[]</span>
        <span class="nv">interface: </span><span class="k">new</span> <span class="nx">LocalBackend</span><span class="p">()</span>
      <span class="p">}</span>
    
    <span class="k">if</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">base_model_endpoint</span>
      <span class="nx">@backends</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nv">log_key: </span><span class="s1">&#39;flakey-server-log&#39;</span>
        <span class="nv">pending_log: </span><span class="p">[]</span>
        <span class="nv">interface: </span><span class="k">new</span> <span class="nx">ServerBackend</span><span class="p">()</span>
      <span class="p">}</span>
      
    <span class="k">if</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">socketio_server</span>
      <span class="nx">@backends</span><span class="p">[</span><span class="s1">&#39;socketio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nv">log_key: </span><span class="s1">&#39;flakey-socketio-log&#39;</span>
        <span class="nv">pending_log: </span><span class="p">[]</span>
        <span class="nv">interface: </span><span class="k">new</span> <span class="nx">SocketIOBackend</span><span class="p">()</span>
      <span class="p">}</span>
    
    <span class="vi">@read = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">read_backend</span> <span class="o">||</span> <span class="s1">&#39;memory&#39;</span> <span class="c1"># Backend to use for read operations</span>
    <span class="nx">@load_logs</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>Pass through methods</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">all: </span><span class="nf">(name) -&gt;</span>
    <span class="k">return</span> <span class="nx">@backends</span><span class="p">[</span><span class="nx">@read</span><span class="p">].</span><span class="nx">interface</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    
  <span class="nv">get: </span><span class="nf">(name, id) -&gt;</span>
    <span class="k">return</span> <span class="nx">@backends</span><span class="p">[</span><span class="nx">@read</span><span class="p">].</span><span class="nx">interface</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
    
  <span class="nv">find: </span><span class="nf">(name, query) -&gt;</span>
    <span class="k">return</span> <span class="nx">@backends</span><span class="p">[</span><span class="nx">@read</span><span class="p">].</span><span class="nx">interface</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    
  <span class="nv">search: </span><span class="nf">(name, re) -&gt;</span>
    <span class="k">return</span> <span class="nx">@backends</span><span class="p">[</span><span class="nx">@read</span><span class="p">].</span><span class="nx">interface</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">re</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>Save an item to the backends</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">save: </span><span class="nf">(name, id, versions, backends = @backends) -&gt;</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">bname</span><span class="p">,</span> <span class="nx">backend</span> <span class="k">of</span> <span class="nx">backends</span>
      <span class="nv">log_msg = </span><span class="s1">&#39;save&#39;</span> <span class="o">+</span> <span class="nx">@delim</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">versions</span><span class="p">])</span>
      <span class="k">if</span> <span class="nx">backend</span><span class="p">.</span><span class="nx">pending_log</span><span class="p">.</span><span class="nx">length</span>
        <span class="nx">backend</span><span class="p">.</span><span class="nx">pending_log</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">log_msg</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">@commit_logs</span><span class="p">()</span>
        <span class="nx">@exec_log</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">false</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">backend</span><span class="p">.</span><span class="nx">interface</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">versions</span><span class="p">)</span>
        <span class="nx">backend</span><span class="p">.</span><span class="nx">pending_log</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">log_msg</span><span class="p">)</span>
        <span class="nx">@commit_logs</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>Delete an item from the backends</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">delete</span><span class="o">:</span> <span class="nf">(name, id, backends = @backends) -&gt;</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">bname</span><span class="p">,</span> <span class="nx">backend</span> <span class="k">of</span> <span class="nx">backends</span>
      <span class="nv">log_msg = </span><span class="s1">&#39;delete&#39;</span> <span class="o">+</span> <span class="nx">@delim</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">])</span>
      <span class="k">if</span> <span class="nx">backend</span><span class="p">.</span><span class="nx">pending_log</span><span class="p">.</span><span class="nx">length</span>
        <span class="nx">backend</span><span class="p">.</span><span class="nx">pending_log</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">log_msg</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">@commit_logs</span><span class="p">()</span>
        <span class="nx">@exec_log</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">false</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">backend</span><span class="p">.</span><span class="nx">interface</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
        <span class="nx">backend</span><span class="p">.</span><span class="nx">pending_log</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">log_msg</span><span class="p">)</span>
        <span class="nx">@commit_logs</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>Execute a backlog of transactions</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">exec_log: </span><span class="nf">() -&gt;</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">backend</span> <span class="k">of</span> <span class="nx">@backends</span>
      <span class="nv">log = </span><span class="nx">backend</span><span class="p">.</span><span class="nx">pending_log</span>
      <span class="k">for</span> <span class="nx">msg</span> <span class="k">in</span> <span class="nx">log</span>
        <span class="k">if</span> <span class="nx">msg</span><span class="o">?</span>
          <span class="nv">action = </span><span class="nx">msg</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">@delim</span><span class="p">)</span>
          <span class="nv">fn = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="nx">backends</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">interface</span><span class="p">[</span><span class="nx">action</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
          <span class="nv">params = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">action</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
          <span class="nv">bends = </span><span class="p">{}</span>
          <span class="nx">bends</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">backend</span>
          <span class="nx">params</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">bends</span><span class="p">)</span>
          <span class="k">if</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="nx">backends</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">interface</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span>
            <span class="nx">backend</span><span class="p">.</span><span class="nx">pending_log</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
          <span class="k">else</span>
            <span class="k">break</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@commit_logs</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      <p>Write log to localStorage</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">commit_logs: </span><span class="nf">(backends = @backends) -&gt;</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">backend</span> <span class="k">of</span> <span class="nx">backends</span>
      <span class="nx">localStorage</span><span class="p">[</span><span class="nx">backend</span><span class="p">.</span><span class="nx">log_key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">backend</span><span class="p">.</span><span class="nx">pending_log</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      <p>Load logs from localStorage</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">load_logs: </span><span class="nf">(backends = @backends) -&gt;</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">backend</span> <span class="k">of</span> <span class="nx">backends</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">localStorage</span><span class="p">[</span><span class="nx">backend</span><span class="p">.</span><span class="nx">log_key</span><span class="p">]</span><span class="o">?</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="nv">backend.pending_log = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">[</span><span class="nx">backend</span><span class="p">.</span><span class="nx">log_key</span><span class="p">])</span>
    <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      <p>Sync backends</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">sync: </span><span class="nf">(name, backends = @backends) -&gt;</span>
    <span class="nv">store = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">bname</span><span class="p">,</span> <span class="nx">backend</span> <span class="k">of</span> <span class="nx">backends</span>
      <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">backend</span><span class="p">.</span><span class="nx">interface</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">store</span><span class="p">)</span>
          <span class="nx">store</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nv">versions = </span><span class="nx">@merge_version_lists</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">versions</span><span class="p">,</span> <span class="nx">store</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">versions</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="nx">store</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">item</span>
    
    <span class="nv">output = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">store</span>
      <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">bname</span><span class="p">,</span> <span class="nx">backend</span> <span class="k">of</span> <span class="nx">backends</span>
      <span class="nx">backend</span><span class="p">.</span><span class="nx">interface</span><span class="p">.</span><span class="nx">_write</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">output</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      <p>Trigger the saved event</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">event_key = </span><span class="s2">&quot;model_#{ name.toLowerCase() }_updated&quot;</span>
    <span class="nx">Flakey</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">event_key</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      <p>Merge 2 version lists</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">merge_version_lists: </span><span class="nf">(a, b) -&gt;</span>
    <span class="nv">temp = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">rev</span> <span class="k">in</span> <span class="nx">a</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">rev</span><span class="p">.</span><span class="nx">time</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">temp</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">rev</span><span class="p">.</span><span class="nx">id</span> <span class="o">!=</span> <span class="nx">temp</span><span class="p">[</span><span class="nx">rev</span><span class="p">.</span><span class="nx">time</span><span class="p">].</span><span class="nx">id</span>
          <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">rev</span><span class="p">.</span><span class="nx">fields</span>
             <span class="nx">temp</span><span class="p">[</span><span class="nx">rev</span><span class="p">.</span><span class="nx">time</span><span class="p">].</span><span class="nx">fields</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
        <span class="k">else</span>
          <span class="nx">temp</span><span class="p">[</span><span class="nx">rev</span><span class="p">.</span><span class="nx">time</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rev</span>
      <span class="k">else</span>
        <span class="nx">temp</span><span class="p">[</span><span class="nx">rev</span><span class="p">.</span><span class="nx">time</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rev</span>
    
    <span class="nv">keys = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">temp</span><span class="p">)</span>
    <span class="nx">keys</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nf">(a, b) -&gt;</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">)</span>
    
    <span class="nv">output = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">keys</span>
      <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">temp</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
    <span class="k">return</span> <span class="nx">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <p>Base object for providing persistance to Model objects.
This gets extended by other classes for various methods (server, localStorage, etc)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">Backend</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      <p>List all objects from the given store</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">all: </span><span class="nf">(name) -&gt;</span>
    <span class="nv">store = </span><span class="nx">@_read</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">store</span>
      <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="nx">store</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      <p>Delete an item by id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">delete</span><span class="o">:</span> <span class="nf">(name, id) -&gt;</span>
    <span class="nv">store = </span><span class="nx">@_read</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="nv">index = </span><span class="nx">@_query_by_id</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">return</span> <span class="kc">true</span>
    <span class="nx">store</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">@_write</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">store</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      <p>Find a set of objects from the given store by performing a query on them.
Pass in an object of params to compare, ex: {title: ['eq', 'The Hitchhikers Guide'], vol: ['gt', 2]}
Only looks at the latest version of an object, not any previous revisions</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">find: </span><span class="nf">(name, query, full_text = false) -&gt;</span>
    <span class="nv">store = </span><span class="nx">@_read</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="nv">set = </span><span class="k">if</span> <span class="nx">full_text</span> <span class="k">then</span> <span class="nx">@_search</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@_query</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span>
    <span class="nv">out = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">set</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">push</span> <span class="nx">store</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">out</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      <p>Get an object from the given store by its id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">get: </span><span class="nf">(name, id) -&gt;</span>
    <span class="nv">store = </span><span class="nx">@_read</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="nv">index = </span><span class="nx">@_query_by_id</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">return</span> <span class="kc">undefined</span>
    <span class="k">return</span> <span class="nx">store</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      <p>Save an object to the store<br />
</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">save: </span><span class="nf">(name, id, versions) -&gt;</span>
    <span class="nv">store = </span><span class="nx">@_read</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">store</span>
      <span class="nv">store = </span><span class="p">[]</span>
    <span class="nv">index = </span><span class="nx">@_query_by_id</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
    <span class="nv">obj = </span><span class="p">{</span>
      <span class="nv">id: </span><span class="nx">id</span><span class="p">,</span>
      <span class="nv">versions: </span><span class="nx">versions</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">store</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">store</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span>
    <span class="k">return</span> <span class="nx">@_write</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">store</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      <p>Query for an index set by performing search
This is SLOW</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">_query: </span><span class="nf">(name, query) -&gt;</span>
    <span class="nv">store = </span><span class="nx">@_read</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">store</span>
      <span class="k">return</span> <span class="p">[]</span>
    
    <span class="nv">set = </span><span class="p">[]</span>
    <span class="nv">i = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">obj</span> <span class="k">in</span> <span class="nx">store</span>
      <span class="nv">rendered = </span><span class="nx">@_render_obj</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
      <span class="nv">match = </span><span class="kc">true</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">query</span>
        <span class="k">if</span> <span class="nx">rendered</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">value</span>
          <span class="nv">match = </span><span class="kc">false</span>
      <span class="k">if</span> <span class="nx">match</span>
        <span class="nx">set</span><span class="p">.</span><span class="nx">push</span> <span class="nx">i</span>
      <span class="nx">i</span><span class="o">++</span>
    
    <span class="k">return</span> <span class="nx">set</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      <p>Query for index by id. Always returns single index, never a set</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">_query_by_id: </span><span class="nf">(name, id) -&gt;</span>
    <span class="nv">store = </span><span class="nx">@_read</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">store</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="nv">i = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">obj</span> <span class="k">in</span> <span class="nx">store</span>
      <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">id</span>
        <span class="k">return</span> <span class="nx">i</span>
      <span class="nx">i</span><span class="o">++</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      <p>Render the latest version of an object by evolving it through all its versions</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">_render_obj: </span><span class="nf">(obj) -&gt;</span>
    <span class="nv">output = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">rev</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">versions</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">rev</span><span class="p">.</span><span class="nx">fields</span>
        <span class="k">switch</span> <span class="nx">value</span><span class="p">.</span><span class="nx">constructor</span>
          <span class="k">when</span> <span class="s1">&#39;Patch&#39;</span>
            <span class="nv">patches = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">diff_patch</span><span class="p">.</span><span class="nx">patch_fromText</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">patch_text</span><span class="p">)</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">diff_patch</span><span class="p">.</span><span class="nx">patch_apply</span><span class="p">(</span><span class="nx">patches</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
          <span class="k">when</span> <span class="nb">Object</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">value</span><span class="p">)</span>
          <span class="k">when</span> <span class="nb">Array</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">[],</span> <span class="nx">value</span><span class="p">)</span>
          <span class="k">else</span>
            <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="k">return</span> <span class="nx">obj</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      <p>Full Text Search</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">_search: </span><span class="nf">(name, query) -&gt;</span>
    <span class="nv">store = </span><span class="nx">@_read</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">store</span>
      <span class="k">return</span> <span class="p">[]</span>
      
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">query</span>
      <span class="nx">query</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">)</span>
    
    <span class="nv">set = </span><span class="p">[]</span>
    <span class="nv">i = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">obj</span> <span class="k">in</span> <span class="nx">store</span>
      <span class="nv">rendered = </span><span class="nx">@_render_obj</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
      <span class="nv">match = </span><span class="kc">false</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">query</span>
        <span class="k">if</span> <span class="nx">value</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">rendered</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
          <span class="nv">match = </span><span class="kc">true</span>
      <span class="k">if</span> <span class="nx">match</span>
        <span class="nx">set</span><span class="p">.</span><span class="nx">push</span> <span class="nx">i</span>
      <span class="nx">i</span><span class="o">++</span>
    
    <span class="k">return</span> <span class="nx">set</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      <p>Virtual Backend that simply stores data in an Object (window.memcache)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">MemoryBackend</span> <span class="k">extends</span> <span class="nx">Backend</span>
  <span class="nv">constructor: </span><span class="nf">() -&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nb">window</span><span class="p">.</span><span class="nx">memcache</span>
      <span class="nb">window</span><span class="p">.</span><span class="nv">memcache = </span><span class="p">{}</span>
    
  <span class="nv">_read: </span><span class="nf">(name) -&gt;</span>
    <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">[],</span> <span class="nb">window</span><span class="p">.</span><span class="nx">memcache</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span>
    
  <span class="nv">_write: </span><span class="nf">(name, store) -&gt;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">memcache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">[],</span> <span class="nx">store</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      <p>LocalStorage Backend</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">LocalBackend</span> <span class="k">extends</span> <span class="nx">Backend</span>
  <span class="nv">constructor: </span><span class="nf">() -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@prefix = </span><span class="s1">&#39;flakey-&#39;</span>
    
  <span class="nv">_read: </span><span class="nf">(name) -&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">localStorage</span><span class="p">[</span><span class="nx">@prefix</span> <span class="o">+</span> <span class="nx">name</span><span class="p">]</span>
      <span class="nx">localStorage</span><span class="p">[</span><span class="nx">@prefix</span> <span class="o">+</span> <span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([])</span>
    <span class="nv">store = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">[</span><span class="nx">@prefix</span> <span class="o">+</span> <span class="nx">name</span><span class="p">])</span>
    <span class="k">return</span> <span class="nx">store</span>
    
  <span class="nv">_write: </span><span class="nf">(name, store) -&gt;</span>
    <span class="nx">localStorage</span><span class="p">[</span><span class="nx">@prefix</span> <span class="o">+</span> <span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">store</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      <p>Server storage backend</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">ServerBackend</span> <span class="k">extends</span> <span class="nx">Backend</span>
  <span class="nv">constructor: </span><span class="nf">() -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@server_cache = </span><span class="p">{}</span>
  
  <span class="nv">build_endpoint_url: </span><span class="nf">(name, id, params) -&gt;</span>
    <span class="nv">url = </span><span class="s2">&quot;#{Flakey.settings.base_model_endpoint}/#{name}&quot;</span>
    <span class="k">if</span> <span class="nx">id</span><span class="o">?</span> <span class="k">then</span> <span class="nx">url</span> <span class="o">+=</span> <span class="s2">&quot;/#{id}&quot;</span>
    <span class="k">if</span> <span class="nx">params</span><span class="o">?</span> <span class="o">and</span> <span class="nx">params</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">Object</span>
      <span class="nv">querystring = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">querystring</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
      <span class="nx">url</span> <span class="o">+=</span> <span class="s2">&quot;?#{querystring}&quot;</span>
    <span class="k">return</span> <span class="nx">url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      <p>List all objects from the given store</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">all: </span><span class="nf">(name) -&gt;</span>
    <span class="nv">store = </span><span class="kc">false</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nv">async: </span><span class="kc">false</span>
      <span class="nv">url: </span><span class="nx">@build_endpoint_url</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
      <span class="nv">dataType: </span><span class="s1">&#39;json&#39;</span>
      <span class="nv">error: </span><span class="nf">() -&gt;</span>
        <span class="nv">Flakey.status.server_online = </span><span class="kc">false</span>
      <span class="nv">success: </span><span class="nf">(data) -&gt;</span>
        <span class="nv">Flakey.status.server_online = </span><span class="kc">true</span>
        <span class="nv">store = </span><span class="nx">data</span>
      <span class="nv">type: </span><span class="s1">&#39;GET&#39;</span>
    <span class="p">})</span>

    <span class="p">(</span><span class="nx">@save_to_cache</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">versions</span><span class="p">)</span> <span class="k">for</span> <span class="nx">obj</span> <span class="k">in</span> <span class="nx">store</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">store</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-79'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-79'>#</a>
      </div>
      <p>Get an object from the given store by its id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">get: </span><span class="nf">(name, id) -&gt;</span>
    <span class="nv">obj = </span><span class="kc">false</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nv">async: </span><span class="kc">false</span>
      <span class="nv">url: </span><span class="nx">@build_endpoint_url</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
      <span class="nv">dataType: </span><span class="s1">&#39;json&#39;</span>
      <span class="nv">error: </span><span class="nf">() -&gt;</span>
        <span class="nv">Flakey.status.server_online = </span><span class="kc">false</span>
      <span class="nv">success: </span><span class="nf">(data) -&gt;</span>
        <span class="nv">Flakey.status.server_online = </span><span class="kc">true</span>
        <span class="nv">obj = </span><span class="nx">data</span>
      <span class="nv">type: </span><span class="s1">&#39;GET&#39;</span>
    <span class="p">})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-80'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-80'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@save_to_cache</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">versions</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">obj</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-81'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-81'>#</a>
      </div>
      <p>Retreive Object from server cache</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">get_from_cache: </span><span class="nf">(name, id) -&gt;</span>
    <span class="k">if</span> <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">][</span><span class="nx">id</span><span class="p">]</span>
        <span class="k">return</span> <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">][</span><span class="nx">id</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">undefined</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-82'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-82'>#</a>
      </div>
      <p>Save an object to the store<br />
</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">save: </span><span class="nf">(name, id, versions, force_write) -&gt;</span>
    <span class="nv">proposed_obj = </span><span class="p">{</span><span class="nv">id: </span><span class="nx">id</span><span class="p">,</span> <span class="nv">versions: </span><span class="nx">versions</span><span class="p">}</span>
    <span class="nv">cached_obj = </span><span class="nx">@get_from_cache</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-83'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-83'>#</a>
      </div>
      <p>Compare cached object to proposed save object
Only actually save if they are different, or if force_write flag is true</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">deep_compare</span><span class="p">(</span><span class="nx">proposed_obj</span><span class="p">,</span> <span class="nx">cached_obj</span><span class="p">)</span> <span class="o">and</span> <span class="nx">force_write</span> <span class="o">!=</span> <span class="kc">true</span>
      <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-84'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-84'>#</a>
      </div>
      <p>Write objects to server</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">status = </span><span class="kc">false</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nv">async: </span><span class="kc">false</span>
      <span class="nv">url: </span><span class="nx">@build_endpoint_url</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
      <span class="nv">data: </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">querystring</span><span class="p">.</span><span class="nx">build</span><span class="p">({</span><span class="nv">id: </span><span class="nx">id</span><span class="p">,</span> <span class="nv">versions: </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">versions</span><span class="p">)})</span>
      <span class="nv">dataType: </span><span class="s1">&#39;json&#39;</span>
      <span class="nv">error: </span><span class="nf">() -&gt;</span>
        <span class="nv">Flakey.status.server_online = </span><span class="kc">false</span>
      <span class="nv">success: </span><span class="nf">() -&gt;</span>
        <span class="nv">Flakey.status.server_online = </span><span class="kc">true</span>
        <span class="nv">status = </span><span class="kc">true</span>
      <span class="nv">type: </span><span class="s1">&#39;POST&#39;</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="nx">status</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-85'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-85'>#</a>
      </div>
      <p>Save object to server_cache</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">save_to_cache: </span><span class="nf">(name, id, versions) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-86'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-86'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="p">{}</span>
    <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">][</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="nv">id: </span><span class="nx">id</span><span class="p">,</span> <span class="nv">versions: </span><span class="nx">versions</span><span class="p">})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-87'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-87'>#</a>
      </div>
      <p>Delete an item by id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">delete</span><span class="o">:</span> <span class="nf">(name, id) -&gt;</span>
    <span class="nv">status = </span><span class="kc">false</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nv">async: </span><span class="kc">false</span>
      <span class="nv">url: </span><span class="nx">@build_endpoint_url</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
      <span class="nv">dataType: </span><span class="s1">&#39;json&#39;</span>
      <span class="nv">error: </span><span class="nf">() -&gt;</span>
        <span class="nv">Flakey.status.server_online = </span><span class="kc">false</span>
      <span class="nv">success: </span><span class="nf">() -&gt;</span>
        <span class="nv">Flakey.status.server_online = </span><span class="kc">true</span>
        <span class="nv">status = </span><span class="kc">true</span>
      <span class="nv">type: </span><span class="s1">&#39;DELETE&#39;</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="nx">status</span>

  <span class="nv">_query: </span><span class="nf">(name, query) -&gt;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">&quot;_query not supported on server backend&quot;</span><span class="p">)</span>

  <span class="nv">_query_by_id: </span><span class="nf">(name, id) -&gt;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">&quot;_query_by_id not supported on server backend&quot;</span><span class="p">)</span>
    
  <span class="nv">_read: </span><span class="nf">(name) -&gt;</span>
    <span class="k">return</span> <span class="nx">@all</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>

  <span class="nv">_write: </span><span class="nf">(name, store) -&gt;</span>
    <span class="nv">status = </span><span class="kc">true</span>
    <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">store</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">@save</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">versions</span><span class="p">)</span>
        <span class="nv">status = </span><span class="kc">false</span>
    <span class="k">return</span> <span class="nx">status</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-88'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-88'>#</a>
      </div>
      <p>Server storage backend</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">SocketIOBackend</span> <span class="k">extends</span> <span class="nx">Backend</span>
  <span class="nv">constructor: </span><span class="nf">() -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-89'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-89'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@status = </span><span class="kc">true</span>
    <span class="vi">@socket = </span><span class="nb">window</span><span class="p">.</span><span class="nv">socket = </span><span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">socketio_server</span><span class="p">)</span>
    <span class="vi">@server_cache = </span><span class="p">{}</span>
    
    <span class="nx">@socket</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">set</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">names = </span><span class="p">[]</span>
      <span class="k">for</span> <span class="nx">obj</span> <span class="k">in</span> <span class="nx">set</span>
        <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">name</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">names</span>
          <span class="nx">names</span><span class="p">.</span><span class="nx">push</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">name</span>
        <span class="nx">@save_to_cache</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">versions</span><span class="p">)</span>
            
      <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">names</span>
        <span class="nx">Flakey</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">backend_controller</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
      
    <span class="nx">@socket</span><span class="p">.</span><span class="nx">emit</span> <span class="s1">&#39;fetch_all&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-90'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-90'>#</a>
      </div>
      <p>List all objects from the given store</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">all: </span><span class="nf">(name) -&gt;</span>
    <span class="nv">store = </span><span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-91'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-91'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="p">{}</span>
    <span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">@get_from_cache</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">))</span> <span class="k">for</span> <span class="nx">id</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]))</span>
    <span class="k">return</span> <span class="nx">store</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-92'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-92'>#</a>
      </div>
      <p>Get an object from the given store by its id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">get: </span><span class="nf">(name, id) -&gt;</span>
    <span class="k">return</span> <span class="nx">@get_from_cache</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-93'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-93'>#</a>
      </div>
      <p>Retreive Object from server cache</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">get_from_cache: </span><span class="nf">(name, id) -&gt;</span>
    <span class="k">if</span> <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">][</span><span class="nx">id</span><span class="p">]</span>
        <span class="k">return</span> <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">][</span><span class="nx">id</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">undefined</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-94'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-94'>#</a>
      </div>
      <p>Save an object to the store<br />
</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">save: </span><span class="nf">(name, id, versions, force_write) -&gt;</span>
    <span class="nv">proposed_obj = </span><span class="p">{</span><span class="nv">id: </span><span class="nx">id</span><span class="p">,</span> <span class="nv">versions: </span><span class="nx">versions</span><span class="p">}</span>
    <span class="nv">cached_obj = </span><span class="nx">@get_from_cache</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-95'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-95'>#</a>
      </div>
      <p>Compare cached object to proposed save object
Only actually save if they are different, or if force_write flag is true</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">deep_compare</span><span class="p">(</span><span class="nx">proposed_obj</span><span class="p">,</span> <span class="nx">cached_obj</span><span class="p">)</span> <span class="o">and</span> <span class="nx">force_write</span> <span class="o">!=</span> <span class="kc">true</span>
      <span class="k">return</span> <span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-96'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-96'>#</a>
      </div>
      <p>Write objects to server</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@socket</span><span class="p">.</span><span class="nx">emit</span> <span class="s1">&#39;write&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nv">name: </span><span class="nx">name</span><span class="p">,</span> <span class="nv">id: </span><span class="nx">id</span><span class="p">,</span> <span class="nv">versions: </span><span class="nx">versions</span><span class="p">},</span> <span class="p">()</span> <span class="o">=&gt;</span>
      <span class="nx">@save_to_cache</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">versions</span>
    <span class="k">return</span> <span class="nx">@status</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-97'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-97'>#</a>
      </div>
      <p>Save object to server_cache</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">save_to_cache: </span><span class="nf">(name, id, versions) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-98'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-98'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="p">{}</span>
    <span class="nx">@server_cache</span><span class="p">[</span><span class="nx">name</span><span class="p">][</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="nv">id: </span><span class="nx">id</span><span class="p">,</span> <span class="nv">versions: </span><span class="nx">versions</span><span class="p">})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-99'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-99'>#</a>
      </div>
      <p>Delete an item by id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">delete</span><span class="o">:</span> <span class="nf">(name, id) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-100'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-100'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nv">name: </span><span class="nx">name</span><span class="p">,</span> <span class="nv">id: </span><span class="nx">id</span><span class="p">})</span>
    <span class="k">return</span> <span class="nx">@status</span>

  <span class="nv">_query: </span><span class="nf">(name, query) -&gt;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">&quot;_query not supported on socketio backend&quot;</span><span class="p">)</span>

  <span class="nv">_query_by_id: </span><span class="nf">(name, id) -&gt;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">&quot;_query_by_id not supported on socketio backend&quot;</span><span class="p">)</span>

  <span class="nv">_read: </span><span class="nf">(name) -&gt;</span>
    <span class="k">return</span> <span class="nx">@all</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>

  <span class="nv">_write: </span><span class="nf">(name, store) -&gt;</span>
    <span class="nv">status = </span><span class="kc">true</span>
    <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">store</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">@save</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">versions</span><span class="p">)</span>
        <span class="nv">status = </span><span class="kc">false</span>
    <span class="k">return</span> <span class="nx">status</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-101'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-101'>#</a>
      </div>
      <p>Export into the main flakey object</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nv">Flakey.models = </span><span class="p">{</span>
  <span class="nv">Model: </span><span class="nx">Model</span><span class="p">,</span>
  <span class="nv">BackendController: </span><span class="nx">BackendController</span><span class="p">,</span>
  <span class="nv">backend_controller: </span><span class="kc">null</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-102'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-102'>#</a>
      </div>
      <h2>Controller Code</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-103'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-103'>#</a>
      </div>
      <p>Subclass this to make controllers for your apps</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">Controller</span>  
  <span class="nv">constructor: </span><span class="nf">(config = {}) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-104'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-104'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@active = </span><span class="nx">@active</span> <span class="o">||</span> <span class="kc">false</span>
    <span class="vi">@actions = </span><span class="nx">@actions</span> <span class="o">||</span> <span class="p">{}</span>
    <span class="vi">@id = </span><span class="nx">@id</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
    <span class="vi">@class_name = </span><span class="nx">@class_name</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
    <span class="vi">@parent = </span><span class="nx">@parent</span> <span class="o">||</span> <span class="kc">null</span>
    <span class="vi">@container = </span><span class="nx">@container</span> <span class="o">||</span> <span class="kc">null</span>
    <span class="vi">@container_html = </span><span class="nx">@container_html</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
    <span class="vi">@subcontrollers = </span><span class="nx">@subcontrollers</span> <span class="o">||</span> <span class="p">[]</span>
    <span class="vi">@query_params = </span><span class="nx">@query_params</span> <span class="o">||</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-105'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-105'>#</a>
      </div>
      <p>Build an HTML container to hold this controller</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@container = </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">))</span>
    <span class="nx">@container</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">@container_html</span><span class="p">)</span>
    <span class="vi">@parent = </span><span class="nx">config</span><span class="p">.</span><span class="nx">parent</span> <span class="o">||</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">container</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">@container</span><span class="p">)</span>
    
    <span class="nx">@container</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">@id</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">@class_name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="nx">@container</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-106'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-106'>#</a>
      </div>
      <p>Append another controller to this one. It will always mimic the active/passive state of this controller</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">append: </span><span class="nf">() -&gt;</span>
    <span class="k">for</span> <span class="nx">Contr</span> <span class="k">in</span> <span class="nx">arguments</span>
      <span class="nv">contr = </span><span class="k">new</span> <span class="nx">Contr</span><span class="p">({</span><span class="nv">parent: </span><span class="nx">@parent</span><span class="p">})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-107'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-107'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">@subcontrollers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">contr</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-108'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-108'>#</a>
      </div>
      <p>Just a stub</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">render: </span><span class="nf">() -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-109'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-109'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-110'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-110'>#</a>
      </div>
      <p>Bind actions to JQuery events  <br />
</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">bind_actions: </span><span class="nf">() -&gt;</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">fn</span> <span class="k">of</span> <span class="nx">@actions</span>
      <span class="nv">key_parts = </span><span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="nv">action = </span><span class="nx">key_parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
      <span class="nv">selector = </span><span class="nx">key_parts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="err">@</span><span class="p">[</span><span class="nx">fn</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-111'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-111'>#</a>
      </div>
      <p>Unbind actions from JQuery events</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">unbind_actions: </span><span class="nf">() -&gt;</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">fn</span> <span class="k">of</span> <span class="nx">@actions</span>
      <span class="nv">key_parts = </span><span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="nv">action = </span><span class="nx">key_parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
      <span class="nv">selector = </span><span class="nx">key_parts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-112'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-112'>#</a>
      </div>
      <p>Set the container html to the given string. Generally you can pass the output of a template render right into this.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">html: </span><span class="nf">(htm) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-113'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-113'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@container_html = </span><span class="nx">htm</span>
    <span class="nx">@container</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">@container_html</span><span class="p">)</span>
    <span class="nx">Flakey</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;html_updated&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-114'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-114'>#</a>
      </div>
      <p>Make this controller active by setting its active class and binding events</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">make_active: </span><span class="nf">() -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-115'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-115'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@active = </span><span class="kc">true</span>
    <span class="nx">@render</span><span class="p">()</span>
    <span class="nx">@bind_actions</span><span class="p">()</span>
    <span class="nx">@container</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;passive&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">sub</span> <span class="k">in</span> <span class="nx">@subcontrollers</span>
      <span class="nx">sub</span><span class="p">.</span><span class="nx">make_active</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-116'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-116'>#</a>
      </div>
      <p>Make this controller inactive and unbind its events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">make_inactive: </span><span class="nf">() -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-117'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-117'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@active = </span><span class="kc">false</span>
    <span class="nx">@unbind_actions</span><span class="p">()</span>
    <span class="nx">@container</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;passive&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">sub</span> <span class="k">in</span> <span class="nx">@subcontrollers</span>
      <span class="nx">sub</span><span class="p">.</span><span class="nx">make_inactive</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-118'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-118'>#</a>
      </div>
      <p>Set the @query_params attribute</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">set_queryparams: </span><span class="nf">(params) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-119'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-119'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@query_params = </span><span class="nx">params</span>
    <span class="k">for</span> <span class="nx">sub</span> <span class="k">in</span> <span class="nx">@subcontrollers</span>
      <span class="nx">sub</span><span class="p">.</span><span class="nx">set_queryparams</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-120'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-120'>#</a>
      </div>
      <p>Subclass a stack to manage a stack of controllers and make sure only one is ever visible at a time.
Very similar interface to an actual controller</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">Stack</span>
  <span class="nv">constructor: </span><span class="nf">(config = {}) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-121'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-121'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@id = </span><span class="nx">@id</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
    <span class="vi">@class_name = </span><span class="nx">@class_name</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
    <span class="vi">@active = </span><span class="nx">@active</span> <span class="o">||</span> <span class="kc">false</span>
    <span class="vi">@controllers = </span><span class="nx">@controllers</span> <span class="o">||</span> <span class="p">{}</span>
    <span class="vi">@routes = </span><span class="nx">@routes</span> <span class="o">||</span> <span class="p">{}</span>
    <span class="vi">@default = </span><span class="nx">@default</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
    <span class="vi">@active_controller = </span><span class="nx">@active_controller</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
    <span class="vi">@parent = </span><span class="nx">@parent</span> <span class="o">||</span> <span class="kc">null</span>
    <span class="vi">@query_params = </span><span class="nx">@query_params</span> <span class="o">||</span> <span class="p">{}</span>
    
    <span class="vi">@container = </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">))</span>
    <span class="nx">@container</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">@id</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">@class_name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="nx">@container</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="nx">@container</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">@container_html</span><span class="p">)</span>
    <span class="vi">@parent = </span><span class="nx">config</span><span class="p">.</span><span class="nx">parent</span> <span class="o">||</span> <span class="nx">Flakey</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">container</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">@container</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">contr</span> <span class="k">of</span> <span class="nx">@controllers</span>
      <span class="nx">@controllers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">contr</span><span class="p">({</span><span class="nv">parent: </span><span class="nx">@container</span><span class="p">})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-122'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-122'>#</a>
      </div>
      <p>Make sure we resolve a controller any time the location hash changes.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;hashchange&#39;</span><span class="p">,</span> <span class="nx">@resolve</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-123'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-123'>#</a>
      </div>
      <p>Resolve the location hash to a controller and make it active</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">resolve: </span><span class="p">()</span> <span class="o">=&gt;</span>
    <span class="nv">hash = </span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">get_hash</span><span class="p">()</span>
    
    <span class="nv">new_controller = </span><span class="kc">undefined</span>
    <span class="k">if</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="nv">hash = </span><span class="nx">hash</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
        <span class="nv">location = </span><span class="nx">hash</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nv">querystring = </span><span class="nx">hash</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span>
        <span class="nv">location = </span><span class="nx">hash</span>
        <span class="nv">querystring = </span><span class="s1">&#39;&#39;</span>
      <span class="nv">new_controller = </span><span class="kc">undefined</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">controller_name</span> <span class="k">of</span> <span class="nx">@routes</span>
        <span class="nv">regex = </span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">route</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">location</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">route</span><span class="p">)</span>
          <span class="nv">new_controller = </span><span class="nx">controller_name</span>
    
    <span class="k">if</span> <span class="o">not</span> <span class="nx">new_controller</span>
      <span class="nb">window</span><span class="p">.</span><span class="nv">location.hash = </span><span class="s2">&quot;##{@default}&quot;</span>
      <span class="k">return</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-124'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-124'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@active_controller = </span><span class="nx">new_controller</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-125'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-125'>#</a>
      </div>
      <p>Parse query params from the hash and send them to the active controller</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@controllers</span><span class="p">[</span><span class="nx">@active_controller</span><span class="p">].</span><span class="nx">set_queryparams</span><span class="p">(</span><span class="nx">Flakey</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">querystring</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">querystring</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-126'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-126'>#</a>
      </div>
      <p>Make all the other controllers inactive</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">own</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">controller</span> <span class="k">of</span> <span class="nx">@controllers</span>
      <span class="k">if</span> <span class="nx">name</span> <span class="o">!=</span> <span class="nx">@active_controller</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-127'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-127'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">@controllers</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">make_inactive</span><span class="p">()</span>
        
    <span class="k">if</span> <span class="nx">@active</span>
      <span class="nx">@controllers</span><span class="p">[</span><span class="nx">@active_controller</span><span class="p">].</span><span class="nx">make_active</span><span class="p">()</span>
      <span class="nx">@controllers</span><span class="p">[</span><span class="nx">@active_controller</span><span class="p">].</span><span class="nx">render</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="nx">@controllers</span><span class="p">[</span><span class="nx">@active_controller</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-128'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-128'>#</a>
      </div>
      <p>Make this stack active</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">make_active: </span><span class="nf">() -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-129'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-129'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">@resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@controllers</span><span class="p">[</span><span class="nx">@active_controller</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">undefined</span>
      <span class="nx">@controllers</span><span class="p">[</span><span class="nx">@active_controller</span><span class="p">].</span><span class="nx">make_active</span><span class="p">()</span>
      <span class="nx">@controllers</span><span class="p">[</span><span class="nx">@active_controller</span><span class="p">].</span><span class="nx">render</span><span class="p">()</span>
    <span class="vi">@active = </span><span class="kc">true</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-130'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-130'>#</a>
      </div>
      <p>Make this stack inactive</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">make_inactive: </span><span class="nf">() -&gt;</span>
    <span class="k">if</span> <span class="nx">@controllers</span><span class="p">[</span><span class="nx">@active_controller</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">undefined</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-131'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-131'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">@controllers</span><span class="p">[</span><span class="nx">@active_controller</span><span class="p">].</span><span class="nx">make_inactive</span><span class="p">()</span>
    <span class="vi">@active = </span><span class="kc">false</span>
  
  <span class="nv">set_queryparams: </span><span class="nf">(params) -&gt;</span>
    <span class="vi">@query_params = </span><span class="nx">params</span>
  
    

<span class="nv">Flakey.controllers = </span><span class="p">{</span>
  <span class="nv">Stack: </span><span class="nx">Stack</span><span class="p">,</span>
  <span class="nv">Controller: </span><span class="nx">Controller</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-132'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-132'>#</a>
      </div>
      <h2>Basic wrapper around Eco templates</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-133'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-133'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nx">Template</span>
  <span class="nv">constructor: </span><span class="nf">(eco, name) -&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-134'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-134'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="vi">@eco = </span><span class="nx">eco</span>
    <span class="vi">@name = </span><span class="nx">name</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-135'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-135'>#</a>
      </div>
      <p>Render this template with the given context object, return the resulting string</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nv">render: </span><span class="nf">(context = {}) -&gt;</span>
    <span class="k">return</span> <span class="nx">@eco</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-136'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-136'>#</a>
      </div>
      <p>Call this to load a Flakey.Template object from a compiled eco template.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nv">get_template = </span><span class="nf">(name, tobj) -&gt;</span>
  <span class="nv">template = </span><span class="nx">tobj</span><span class="p">.</span><span class="nx">ecoTemplates</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Template</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>

<span class="nv">Flakey.templates = </span><span class="p">{</span>
  <span class="nx">get_template</span>
  <span class="nv">Template: </span><span class="nx">Template</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-137'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-137'>#</a>
      </div>
      <h2>CommonJS exports</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-138'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-138'>#</a>
      </div>
      <p>Make this available via CommonJS</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">if</span> <span class="nx">module</span><span class="o">?</span>
  <span class="nv">module.exports = </span><span class="nx">Flakey</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-139'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-139'>#</a>
      </div>
      <p>Assign it to the window object, if we're in a browser and a window exists.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">if</span> <span class="nb">window</span>
  <span class="nb">window</span><span class="p">.</span><span class="nv">Flakey = </span><span class="nx">Flakey</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
